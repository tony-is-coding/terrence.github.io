### MySQL
##### 1. 解释MySQL中的事务隔离级别及其各自的特点
- 读未提交: 两个事务, 事务A 可以读到 事务B  未提交的数据, 存在的问题
    - 脏读 (读到其他事务未提交的数据--可能回滚)
    - 幻读
    - 不可重复读 
    
- 读已提交: 两个事务， 事务A 可以读到 事务B 已提交的数据，存在问题
    - 幻读
    - 不可重复度 
    
- 可重复读
    - MVCC, 多版本事务机制,  一致性快照读 + Next-Key Lock 间隙锁

- 序列化

##### 2. 如何在MySQL中优化慢查询？
通过 explain 分析出现慢查询的SQL, 定位看下 
- 是否有多子查询问题？
- 是否合理命中索引? 选择性
- 扫描的行和最终查询行情况? 

进行相关优化
- 优化索引, 优化查询SQL本身, 确保能够使用索引, 以下用法可能导致索引无法使用
    - 使用函数或表达式
    - 不匹配的数据类型(比如字符串类型 使用了 数字  select A where A = 123; A 是字符类型时)
    - 在使用 LIKE 语句时，如果通配符（如 % 或 _）出现在模式的开头，索引将不会被使用
    - 在使用 OR 语句时，OR 前后的列没有同时都为索引列, 那么整个查询都不会使用索引
    - 未遵循最左前缀查询需求
    - 大范围扫描, 数据量过大可能导致执行引擎选择全表扫描
- 优化查询的数据集, 避免一次性查询过多数据
- 优化查询字段,非必要字段不进行查询

##### 3. 请描述MySQL的索引类型，以及如何根据查询优化索引？
- B-tree 索引
- Hash索引
- 全文索引
- 空间索引 
主流的 innodb 存储引擎使用的是 B-tree索引, 底层实现是基于B+tree的设计
B+树：平滑查找树Btree的变种 和 BTree的区别在于 B+Tree只在叶子节点存储数据, 父类节点和根类节点不存储数据, 只存储子节点的指针

优势:
1. 更大的扇出带来了更低的树高
2. 叶子节点连续对范围查询友好

##### 4. MySQL的主从复制原理是什么？它如何工作？
binlog 二进制日志
1. 


##### 5. 如何处理MySQL的锁竞争？
分析 show_status与show_lock_wait,这些可以看到目前阻塞的锁有哪些
通常来说:
大的耗时高的事务操作会导致锁竞争
优化方案
- 减少大事务操作
- 优化查询, 尽量让查询精准

短期方案
1. 快速定位问题原因, 是否因代码SQL异常导致 -- 考虑是否需要回滚 或者进行hotfix 或者加索引之类的
2. db层面可以考虑将隔离级别降低, 如果系统业务没有太多事务竞争的话 -- 考虑减少 next-key lock带来的问题
3. 如果有从库，看能否有支持将读操作转接到从库的中间件方案

长期方案:
1. 代码审核审计优化

##### 6. 解释MySQL中的二进制日志（binlog）和重做日志（redo log）。

binlog 是数据库变更操作的行为日志
- 复制
- 订阅数据变更
- 数据恢复


redolog 主要是 innodb 存储引擎为了保证事务数据持久性而落地的物理日志
- 数据库崩溃恢复

场景不同



##### 7. 如何配置和优化MySQL的缓冲池？


##### 8. MySQL中的分区表是什么？使用场景有哪些？


##### 9. 如何在MySQL中进行备份和恢复？

##### 10. MySQL如何实现数据的一致性和持久性？
- 通过redo-log 实现持久性
- 事务数据一致性, 底层是通过MVCC机制, 多版本控制机制, 每个数据都是基于快照读 



### Redis
##### 1. Redis支持哪些数据类型？各自的使用场景是什么？
- string k/v  : 常规的键值场景, 单个key类型数据, 一般是需要一次性访问全部获取所有数据的场景
- map   字典  : 对象类型数据如用户, 有名称、邮箱、等级等； 使用对象类型对对象中的单key 需要频繁访问和修改的
- list  列表 : 列表格式, 偶尔用作分布式 队列使用
- set   集合 : 分布式唯一key 使用
- zset  有序集合  skiplist  排行榜之类的东西，因为带了个 score 

##### 2. 解释Redis的持久化机制，包括RDB和AOF。
- RDB 数据快照 定时将数据全量同步到磁盘
    - 优点: 适用快速恢复数据场景
    - 缺点: 全量数据落地可能影响性能, 崩溃后上一次备份后到当前的数据全部丢失
- AOF 变更记录日志, 定期进行数据从 内存中写入磁盘
    - 优点: 适用于数据完整性要求较高的场景,如果设置1秒同步一次数据到磁盘, 数据丢失最多1s 内的
    - 缺点: aof 文件远大于 rdb 恢复起来会慢点

##### 3. 如何在Redis中实现分布式锁？
通过 setNx 

##### 5. 在Redis中，如何处理内存数据溢出的情况？
##### 6. Redis的发布订阅模型是如何工作的？

##### 7. 如何优化Redis的性能？

##### 8. Redis集群的工作原理及其优点是什么？
redis 集群底层实现还是基于 一致性hash 将key 分化到 16384 个 slot中, 分化到多个集群分片中，通过客户端命令hash 到具体的分片去获取对应的key

多个集群通过 gossip 协议 进行节点活性验证, 最长信任列表的方案

优点: 
- 负载均衡
- 槽分化、数据不会过分冗余
- 主从节点


##### 9. 如何使用Lua脚本在Redis中处理事务？
##### 10. Redis中的键过期策略是什么？
- LRU 最近最少使用原则


1. 在项目中缓存是如何使用的？为什么要用缓存？缓存使用不当会造成什么后果

    在项目中缓存是如何使用的？
    - redis 主要是存储一些运营的配置数据
    - 产品下所有的交易结构数据等 几百条
    - 资金项目key数据等

    为什么要用缓存？
    - 使用缓冲主要还是加速访问, 有些数据组装多表查询但是改动又很少, 可以放到缓存中
    - 产品业务数据常用的数据也更新到看缓存

2. redis 都有哪些数据类型？分别在哪些场景下使用比较合适？
- 

3. Redis的过期策略有哪些？
- lru 定时过期 、 惰性过期

4. Redis如果大量的key设置同一时间过期，可能发生什么?
可能导致缓存雪崩现象
因为大批量的 key 同时过期导致大量大量缓存不可用，大量的请求同时会达到数据库中
- 解决方案
 设置不同的过期时间，使用随机函数

5. 使用过Redis分布式锁么，它是什么回事?
分布式锁 在redis 的实现方案是 基于 setNx这个命令来实现的
 
setnx 如果key 存在则不能设置，setnx 之后再加上一个 setex 对key 进行过期, 同时通过lua 脚本的方式对key进行事务保证

redis> set key value nx ex {timeout}

6. Redis里面有1亿个key，其中有10w个key是以某个固定的已知的前缀开头的，如何将它们全部找出来？
keys xxx_* 前缀获取，但是 keys XX*可能导致性能慢
通过 scan 命令获取比较合适，scan 异步获取不会阻塞全局

10W个数据量比较大，推荐还是

scan  "prefix_*" COUNT  2000  -- 一次性返回2000 个这样

7. 如果有大量的key需要设置同一时间过期，一般需要注意什么？
- 需要注意缓存雪崩问题, 同一时间过期需要考虑
- redis 需要过期这些键,  释放内存也会导致CPU消耗问题等

尽量避免

8. 如何保证缓存与数据库的双写一致性? 为什么是删除缓存，而不是更新缓存？
数据库双写一致性
cache aside 解决方案

-  读  缓存->db(写入缓存--这个时候可以考虑缓存是否存在，存在则进行更新操作即可)
-  更新 
    1. 更新数据库 2. 删除缓存
    删除缓存的原因还是因为
     - 一个缓存的组成有多个数据集合结果
     - 从查询端写入缓存其实更合理的，更加接近缓存的诉求

9. redis 的并发竞争问题是什么？如何解决这个问题？了解redis 事务的 CAS 方案吗？

10. Redis 集群模式的工作原理能说一下么？在集群模式下，Redis 的 key 是如何寻址的？分布式寻址都有哪些算法？了解一致性 hash 算法吗？
    
    
 11. BigKey、HotKey 问题严重，该如何 预防和解决
 bigkey 、 hotkey 有检测命令，也可以通过内部自研平台检测
 1. bigkey
 考虑将key 划分成多个子key
 2. hotkey 主要问题是集群情况下, 可能导致集中式访问，

 
   
   
12. 分布式锁的问题

- 比如在集群情况下,  某一个节点挂了，分布式就永远没办法被解锁了
   



### RabbitMQ
##### 1. RabbitMQ的核心组件包括哪些？
- queue
- broker
- consumer/publisher
 


##### 2. 解释RabbitMQ中的消息确认机制。
##### 3. RabbitMQ如何处理消息持久化？
##### 4. 如何在RabbitMQ中实现高可用性？
##### 5. RabbitMQ的交换机类型有哪些？各自的适用场景是什么？
##### 6. RabbitMQ中的死信队列是什么？它是如何工作的？
##### 7. 如何在RabbitMQ中进行性能调优？
##### 8. 解释RabbitMQ的流量控制机制及其重要性。
##### 9. RabbitMQ的镜像队列是什么？有什么优点和缺点？
##### 10. 在RabbitMQ中，如何配置和使用延时消息？
